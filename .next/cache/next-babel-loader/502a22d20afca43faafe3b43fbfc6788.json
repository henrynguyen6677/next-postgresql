{"ast":null,"code":"// const mysql = require('serverless-mysql')\n// const db = mysql({\n//   config: {\n//     host: process.env.MYSQL_HOST,\n//     database: process.env.MYSQL_DATABASE,\n//     user: process.env.MYSQL_USER,\n//     password: process.env.MYSQL_PASSWORD,\n//   },\n// })\n// const client = new ServerlessClient({\n//     user: process.env.DB_USER,\n//     host: process.env.DB_HOST,\n//     database: process.env.DB_NAME,\n//     password: process.env.DB_PASSWORD,\n//     // port: process.env.DB_PORT\n// });\nimport ServerlessClient from 'serverless-postgres';\nconsole.log(ServerlessClient);\nconst hostname = '127.0.0.1';\nconst port = 7000;\n\nconst doConnect = async () => {\n  try {\n    const client = new ServerlessClient({\n      user: process.env.DB_USER,\n      host: \"localhost\",\n      database: process.env.DB_NAME,\n      password: process.env.DB_PASSWORD //   port: process.env.DB_PORT\n\n    });\n    console.log({\n      user,\n      host,\n      database,\n      password,\n      port\n    });\n    await client.sconnect();\n    await client.query(`SELECT NOW()`);\n    console.log(\"connection ok\");\n    await client.clean();\n  } catch (e) {\n    console.log(e.message);\n  }\n};\n\ndoConnect();\nconst db = ServerlessClient({\n  host: process.env.DB_HOST,\n  database: process.env.DB_NAME,\n  user: process.env.DB_USER,\n  password: process.env.DB_PASSWORD\n});\n\nexports.query = async query => {\n  try {\n    const results = await db.query(query);\n    await db.end();\n    return results;\n  } catch (error) {\n    return {\n      error\n    };\n  }\n};","map":{"version":3,"sources":["/home/hnd/ws/learn/amplify/nextjs/next-mysql/lib/db.js"],"names":["ServerlessClient","console","log","hostname","port","doConnect","client","user","process","env","DB_USER","host","database","DB_NAME","password","DB_PASSWORD","sconnect","query","clean","e","message","db","DB_HOST","exports","results","end","error"],"mappings":"AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,OAAOA,gBAAP,MAA6B,qBAA7B;AACAC,OAAO,CAACC,GAAR,CAAYF,gBAAZ;AAGA,MAAMG,QAAQ,GAAG,WAAjB;AACA,MAAMC,IAAI,GAAG,IAAb;;AAEA,MAAMC,SAAS,GAAG,YAAY;AAC5B,MAAI;AACF,UAAMC,MAAM,GAAG,IAAIN,gBAAJ,CAAqB;AAClCO,MAAAA,IAAI,EAAEC,OAAO,CAACC,GAAR,CAAYC,OADgB;AAElCC,MAAAA,IAAI,EAAE,WAF4B;AAGlCC,MAAAA,QAAQ,EAAEJ,OAAO,CAACC,GAAR,CAAYI,OAHY;AAIlCC,MAAAA,QAAQ,EAAEN,OAAO,CAACC,GAAR,CAAYM,WAJY,CAKpC;;AALoC,KAArB,CAAf;AAQAd,IAAAA,OAAO,CAACC,GAAR,CAAY;AACRK,MAAAA,IADQ;AAERI,MAAAA,IAFQ;AAGRC,MAAAA,QAHQ;AAIRE,MAAAA,QAJQ;AAKRV,MAAAA;AALQ,KAAZ;AAQA,UAAME,MAAM,CAACU,QAAP,EAAN;AACA,UAAMV,MAAM,CAACW,KAAP,CAAc,cAAd,CAAN;AACAhB,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACA,UAAMI,MAAM,CAACY,KAAP,EAAN;AACD,GArBD,CAqBE,OAAOC,CAAP,EAAU;AACVlB,IAAAA,OAAO,CAACC,GAAR,CAAYiB,CAAC,CAACC,OAAd;AACD;AACF,CAzBD;;AA2BAf,SAAS;AAET,MAAMgB,EAAE,GAAGrB,gBAAgB,CAAC;AACxBW,EAAAA,IAAI,EAAEH,OAAO,CAACC,GAAR,CAAYa,OADM;AAExBV,EAAAA,QAAQ,EAAEJ,OAAO,CAACC,GAAR,CAAYI,OAFE;AAGxBN,EAAAA,IAAI,EAAEC,OAAO,CAACC,GAAR,CAAYC,OAHM;AAIxBI,EAAAA,QAAQ,EAAEN,OAAO,CAACC,GAAR,CAAYM;AAJE,CAAD,CAA3B;;AAOAQ,OAAO,CAACN,KAAR,GAAgB,MAAOA,KAAP,IAAiB;AAC/B,MAAI;AACF,UAAMO,OAAO,GAAG,MAAMH,EAAE,CAACJ,KAAH,CAASA,KAAT,CAAtB;AACA,UAAMI,EAAE,CAACI,GAAH,EAAN;AACA,WAAOD,OAAP;AACD,GAJD,CAIE,OAAOE,KAAP,EAAc;AACd,WAAO;AAAEA,MAAAA;AAAF,KAAP;AACD;AACF,CARD","sourcesContent":["// const mysql = require('serverless-mysql')\n\n// const db = mysql({\n//   config: {\n//     host: process.env.MYSQL_HOST,\n//     database: process.env.MYSQL_DATABASE,\n//     user: process.env.MYSQL_USER,\n//     password: process.env.MYSQL_PASSWORD,\n//   },\n// })\n\n// const client = new ServerlessClient({\n//     user: process.env.DB_USER,\n//     host: process.env.DB_HOST,\n//     database: process.env.DB_NAME,\n//     password: process.env.DB_PASSWORD,\n//     // port: process.env.DB_PORT\n// });\n\nimport ServerlessClient from 'serverless-postgres'\nconsole.log(ServerlessClient)\n\n\nconst hostname = '127.0.0.1';\nconst port = 7000;\n\nconst doConnect = async () => {\n  try {\n    const client = new ServerlessClient({\n      user: process.env.DB_USER,\n      host: \"localhost\",\n      database: process.env.DB_NAME,\n      password: process.env.DB_PASSWORD,\n    //   port: process.env.DB_PORT\n    });\n\n    console.log({\n        user,\n        host,\n        database,\n        password,\n        port\n    })\n\n    await client.sconnect();\n    await client.query(`SELECT NOW()`);\n    console.log(\"connection ok\");\n    await client.clean();\n  } catch (e) {\n    console.log(e.message);\n  }\n}\n\ndoConnect()\n\nconst db = ServerlessClient({\n    host: process.env.DB_HOST,\n    database: process.env.DB_NAME,\n    user: process.env.DB_USER,\n    password: process.env.DB_PASSWORD,\n  })\n\nexports.query = async (query) => {\n  try {\n    const results = await db.query(query)\n    await db.end()\n    return results\n  } catch (error) {\n    return { error }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}