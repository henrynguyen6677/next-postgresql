{"ast":null,"code":"\"use strict\";\n\nvar db = _interopRequireWildcard(require(\"../../../lib/db\"));\n\nvar _sqlTemplateStrings = _interopRequireDefault(require(\"sql-template-strings\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nmodule.exports = async (req, res) => {\n  let page = parseInt(req.query.page) || 1;\n  const limit = parseInt(req.query.limit) || 9;\n  if (page < 1) page = 1;\n  const users = await db.query((0, _sqlTemplateStrings.default)`\n      SELECT *\n      FROM users\n      ORDER BY id\n      LIMIT ${(page - 1) * limit}, ${limit}\n    `);\n  const count = await db.query((0, _sqlTemplateStrings.default)`\n      SELECT COUNT(*)\n      AS usersCount\n      FROM users\n    `);\n  console.log(count);\n  const {\n    usersCount\n  } = count;\n  const pageCount = Math.ceil(usersCount / limit);\n  res.status(200).json({\n    users,\n    pageCount,\n    page\n  });\n};","map":{"version":3,"sources":["/home/hnd/ws/learn/amplify/nextjs/next-mysql/pages/api/users/index.js"],"names":["module","exports","req","res","page","parseInt","query","limit","users","db","count","console","log","usersCount","pageCount","Math","ceil","status","json"],"mappings":";;AAAA;;AACA;;;;;;;;AAEAA,MAAM,CAACC,OAAP,GAAiB,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AACnC,MAAIC,IAAI,GAAGC,QAAQ,CAACH,GAAG,CAACI,KAAJ,CAAUF,IAAX,CAAR,IAA4B,CAAvC;AACA,QAAMG,KAAK,GAAGF,QAAQ,CAACH,GAAG,CAACI,KAAJ,CAAUC,KAAX,CAAR,IAA6B,CAA3C;AACA,MAAIH,IAAI,GAAG,CAAX,EAAcA,IAAI,GAAG,CAAP;AACd,QAAMI,KAAK,GAAG,MAAMC,EAAE,CAACH,KAAH,CAAS,gCAAO;;;;cAIxB,CAACF,IAAI,GAAG,CAAR,IAAaG,KAAM,KAAIA,KAAM;KAJrB,CAApB;AAMA,QAAMG,KAAK,GAAG,MAAMD,EAAE,CAACH,KAAH,CAAS,gCAAO;;;;KAAhB,CAApB;AAKAK,EAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACA,QAAM;AAAEG,IAAAA;AAAF,MAAiBH,KAAvB;AACA,QAAMI,SAAS,GAAGC,IAAI,CAACC,IAAL,CAAUH,UAAU,GAAGN,KAAvB,CAAlB;AACAJ,EAAAA,GAAG,CAACc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEV,IAAAA,KAAF;AAASM,IAAAA,SAAT;AAAoBV,IAAAA;AAApB,GAArB;AACD,CAnBD","sourcesContent":["import * as db from '../../../lib/db'\nimport escape from 'sql-template-strings'\n\nmodule.exports = async (req, res) => {\n  let page = parseInt(req.query.page) || 1\n  const limit = parseInt(req.query.limit) || 9\n  if (page < 1) page = 1\n  const users = await db.query(escape`\n      SELECT *\n      FROM users\n      ORDER BY id\n      LIMIT ${(page - 1) * limit}, ${limit}\n    `)\n  const count = await db.query(escape`\n      SELECT COUNT(*)\n      AS usersCount\n      FROM users\n    `)\n  console.log(count)\n  const { usersCount } = count\n  const pageCount = Math.ceil(usersCount / limit)\n  res.status(200).json({ users, pageCount, page })\n}\n"]},"metadata":{},"sourceType":"script"}